

<!DOCTYPE html>
<html class="writer-html5" lang="it" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Aziona CLI Documentation &mdash; aziona 0.1.14 documentazione</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Indice" href="genindex.html" />
    <link rel="search" title="Cerca" href="search.html" />
    <link rel="next" title="cli" href="references/cli/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> aziona
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">References API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="references/cli/index.html">cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="references/core/index.html">core</a></li>
</ul>
<p class="caption"><span class="caption-text">Changelog</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog/version_1_0.html">v1.0.0</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">aziona</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
        
      <li>Aziona CLI Documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="aziona-cli-documentation">
<h1>Aziona CLI Documentation<a class="headerlink" href="#aziona-cli-documentation" title="Link a questa intestazione">¶</a></h1>
<p><img alt="image0" src="https://img.shields.io/badge/version-0.1-green.svg" /></p>
<p><img alt="image1" src="https://img.shields.io/badge/docker--compose-build-blue.svg" /> <img alt="image2" src="https://img.shields.io/badge/docker-build-blue.svg" /></p>
<div class="figure align-default" id="id1">
<img alt="Python" src="https://img.shields.io/badge/-Python-fff?&amp;logo=python" />
<p class="caption"><span class="caption-text">Python</span><a class="headerlink" href="#id1" title="Link a questa immagine">¶</a></p>
</div>
<p>Aziona CLI is a cross CI platform tool that enables the building,
testing, releasing, and deploying, DevOps/GitOps process steps.
Pipelines have two major problems, namely the setup of the environment
with all the dependencies, environmental variables and the management
and maintenance of scripts to be executed during the CI/CD process.
Aziona CLI tries to simplify the aforementioned aspects by allowing
developers to create agnostic and platform-independent configurations.
The advantage of Aziona configurations is that you can declare in one or
more YML / Json files the tasks, environment variables, and dependencies
needed to run the pipeline.</p>
<div class="figure align-default" id="id2">
<img alt="File" src="https://raw.githubusercontent.com/azionaventures/aziona-cli/main/docs/images/aziona_process.png" />
<p class="caption"><span class="caption-text">File</span><a class="headerlink" href="#id2" title="Link a questa immagine">¶</a></p>
</div>
<div class="section" id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link a questa intestazione">¶</a></h2>
<p>Aziona CLI is written in Python3 and can be used in various ways in both
local and pipelined environments, such as a:</p>
<ul class="simple">
<li><p>Container image (Ubuntu 20.04)</p></li>
<li><p>Python package</p></li>
<li><p>GitHub action</p></li>
</ul>
<p><strong>YML structure</strong></p>
<p>The YML structure is divided into targets that include multiple stages;
on top of that, you can inject a custom environment and additional
settings. Each stage is defined as a single action that imports modules
executed with optional arguments.</p>
<div class="figure align-default" id="id3">
<img alt="File" src="https://raw.githubusercontent.com/azionaventures/aziona-cli/main/docs/images/aziona_file.png" />
<p class="caption"><span class="caption-text">File</span><a class="headerlink" href="#id3" title="Link a questa immagine">¶</a></p>
</div>
<p><strong>Modules</strong> Modules are actions executed by a stage; they have different
types like Python or bash modules. Each module has to have defined the
type, module, and eventually additional arguments.</p>
</div>
<div class="section" id="develop-environment">
<h2>Develop environment<a class="headerlink" href="#develop-environment" title="Link a questa intestazione">¶</a></h2>
<p><strong>Requirements</strong></p>
<ul class="simple">
<li><p>python &gt;= 3.6</p></li>
<li><p>pip3</p></li>
<li><p>docker and docker-compose</p></li>
</ul>
<p><strong>Setup</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">azionaventures</span><span class="o">/</span><span class="n">aziona</span><span class="o">-</span><span class="n">cli</span><span class="o">.</span><span class="n">git</span>
<span class="n">sudo</span> <span class="n">make</span> <span class="n">setup</span><span class="o">-</span><span class="n">dev</span>
<span class="n">source</span> <span class="o">./</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">active</span>
</pre></div>
</div>
</div>
<div class="section" id="local-environment">
<h2>Local environment<a class="headerlink" href="#local-environment" title="Link a questa intestazione">¶</a></h2>
<p><strong>Requirements</strong></p>
<ul class="simple">
<li><p>python &gt;= 3.6</p></li>
<li><p>pip3</p></li>
<li><p>docker and docker-compose</p></li>
</ul>
<p><strong>Setup</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip3</span> <span class="n">install</span> <span class="n">aziona</span>

<span class="c1"># or</span>

<span class="n">pip3</span> <span class="n">install</span> <span class="n">aziona</span><span class="o">==</span><span class="n">VERSION</span>
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link a questa intestazione">¶</a></h2>
<p><strong>Ex. Release docker image into Aws ECR from Local env</strong></p>
<p>Require: AWS account and Dockerfile</p>
<p>Create project folder, and create file <code class="docutils literal notranslate"><span class="pre">.aziona.yml</span></code> with the snippet
below.</p>
<p>Create ECR repository in the AWS region where your profile is pointing.</p>
<p>Edit <code class="docutils literal notranslate"><span class="pre">.aziona.yml</span></code> and export to shell env vars:</p>
<ol class="arabic simple">
<li><p>export AWS_ACCESS_KEY_ID=xxx</p></li>
<li><p>export AWS_SECRET_ACCESS_KEY=xxx</p></li>
<li><p>export AWS_ACCOUNT_ID=xxx</p></li>
<li><p>export AWS_ECR_REGION=xxx</p></li>
<li><p>export AWS_ECR_REPOSITORY=xxx</p></li>
</ol>
<p>Create sample Dockerfile.</p>
<p>Finally, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aziona</span> <span class="n">release</span>
</pre></div>
</div>
<p>This aziona configuration file firstly makes login on Ecr service,
nextly, build docker image, and endly push image to ecr repository</p>
<p>Snippet</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>version: &quot;1&quot;

targets:
  release:
    stages:
      login:
        module: aziona.packages.docker.login_aws_credentials
        args:
          --region: ${AWS_ECR_REGION}
          --registry: ${AWS_ECR_REGISTRY}
      build:
        module: aziona.packages.docker.build
        args:
          --path: .
          --dockerfile: Dockerfile
          --tag: ${DOCKER_IMAGE}
      push:
        module: aziona.packages.docker.push
        args:
          --image: ${DOCKER_IMAGE}

env:
  AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
  AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
  AWS_ACCOUNT_ID: ${AWS_ACCOUNT_ID}
  AWS_ECR_REGION: ${AWS_ECR_REGION}
  AWS_ECR_REPOSITORY: ${AWS_ECR_REPOSITORY}
  AWS_ECR_REGISTRY: ${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_ECR_REGION}.amazonaws.com
  DOCKER_IMAGE: ${AWS_ECR_REGISTRY}/${AWS_ECR_REPOSITORY}:latest
</pre></div>
</div>
<p>In the case in the local environment you want to use the aws profiles
configured in .aws/credentials you have to use the following
configuration:</p>
<ol class="arabic simple">
<li><p>You need to add this args <code class="docutils literal notranslate"><span class="pre">--profile:</span> <span class="pre">${AWS_PROFILE}</span></code> to <em>login</em>
stage</p></li>
<li><p>Change the env to and export vars:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>env:
  AWS_PROFILE: ${AWS_PROFILE}
  AWS_ACCOUNT_ID: ${AWS_ACCOUNT_ID}
  AWS_ECR_REGION: ${AWS_ECR_REGION}
  AWS_ECR_REPOSITORY: ${AWS_ECR_REPOSITORY}
  AWS_ECR_REGISTRY: ${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_ECR_REGION}.amazonaws.com
  DOCKER_IMAGE: ${AWS_ECR_REGISTRY}/${AWS_ECR_REPOSITORY}:latest
</pre></div>
</div>
<blockquote>
<div><p>[WARNING] It is not recommended to put sensitive data directly into
the env.</p>
</div></blockquote>
<p><strong>Ex. Release docker image into Aws ECR from GitHub Action</strong></p>
<p>Let’s start with the “Local env” example.</p>
<p>Now that we’ve texted the process in a local environment, we can create
a pipeline in GitHub (or your reference system) that executes our
actions.</p>
<p>First, we need to create a “.github” folder in the root of the project
with another folder called “workflows” inside.</p>
<p>Create the following secrets in Github:</p>
<ol class="arabic simple">
<li><p>AWS_ACCESS_KEY_ID</p></li>
<li><p>AWS_SECRET_ACCESS_KEY</p></li>
<li><p>AWS_ACCOUNT_ID</p></li>
<li><p>AWS_ECR_REGION</p></li>
<li><p>AWS_ECR_REPOSITORY</p></li>
</ol>
<p>Then create a release.yml file in .github/workflows and paste the
following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>name: Release docker image to AWS ECR

on:
  push:
    branches:
      - &quot;main&quot;

env:
  AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
  AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
  AWS_ACCOUNT_ID: ${{ secrets.AWS_ACCOUNT_ID }}
  AWS_ECR_REGION: ${{ secrets.AWS_ECR_REGION }}
  AWS_ECR_REPOSITORY: ${{ secrets.AWS_ECR_REPOSITORY }}

jobs:
  release:
    name: Push image on ECR
    runs-on: ubuntu-20.04

    steps:
      - name: Checkout
      uses: actions/checkout@v2

      - name: Checkout Action - Aziona CLI
      uses: actions/checkout@v2
      with:
          repository: azionaventures/aziona-cli
          ref:  main
          path: .github/actions/aziona

      - name: Aziona cli
      uses: ./.github/actions/aziona
      with:
          target: release
</pre></div>
</div>
<p>This pipeline will be started whenever a push is made to the main. The
GitHub action of aziona-cli is used to execute the “release” target,
which will execute all the actions defined in the .aziona.yml file. This
way we can test the pipeline locally and be independent of the
versioning system.</p>
<p><strong>Ex. Release docker image into Aws ECR from Bitbucket pipeline</strong></p>
<p>Let’s start with the “Local env” example.</p>
<p>Create il file bitbucket-pipelines.yml nella root del progetto e
inserite il seguente codice:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span>

<span class="n">options</span><span class="p">:</span>
  <span class="n">docker</span><span class="p">:</span> <span class="n">true</span>

<span class="n">pipelines</span><span class="p">:</span>
  <span class="n">branches</span><span class="p">:</span>
    <span class="n">main</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">step</span><span class="p">:</span>
          <span class="n">name</span><span class="p">:</span> <span class="n">Release</span> <span class="n">docker</span> <span class="n">image</span> <span class="n">to</span> <span class="n">AWS</span> <span class="n">ECR</span>
          <span class="n">deployment</span><span class="p">:</span> <span class="n">env</span>
          <span class="n">image</span><span class="p">:</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">azionaventures</span><span class="o">/</span><span class="n">aziona</span><span class="o">-</span><span class="n">cli</span><span class="p">:</span><span class="mf">0.1</span>
          <span class="n">script</span><span class="p">:</span>
            <span class="o">-</span> <span class="n">aziona</span> <span class="n">release</span>
</pre></div>
</div>
<p>Create deployment named <em>env</em>. Enter the following keys in the
deployment:</p>
<ol class="arabic simple">
<li><p>AWS_ACCESS_KEY_ID</p></li>
<li><p>AWS_SECRET_ACCESS_KEY</p></li>
<li><p>AWS_ACCOUNT_ID</p></li>
<li><p>AWS_ECR_REGION</p></li>
<li><p>AWS_ECR_REPOSITORY</p></li>
</ol>
<p>The pipeline will use the action-cli:0.1 image to execute the step.</p>
</div>
<div class="section" id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Link a questa intestazione">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. Open issue
2. Use module `aziona.core` for I/O, logging, settings etc
3. Formatting and fix code with `make lint`
4. Merge request
</pre></div>
</div>
<div class="toctree-wrapper compound" id="references">
<p class="caption"><span class="caption-text">References API</span><a class="headerlink" href="#references" title="Link a questo indice">¶</a></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="references/cli/index.html">cli</a><ul>
<li class="toctree-l2"><a class="reference internal" href="references/cli/main.html">main</a></li>
<li class="toctree-l2"><a class="reference internal" href="references/cli/parser/parser.html">parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="references/cli/parser/v1/driver.html">driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="references/core/index.html">core</a><ul>
<li class="toctree-l2"><a class="reference internal" href="references/core/conf/index.html">conf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="references/core/conf/settings.html">settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="references/core/conf/const.html">const</a></li>
<li class="toctree-l3"><a class="reference internal" href="references/core/conf/errors.html">errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="references/core/conf/session.html">session</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="references/core/log.html">log</a></li>
<li class="toctree-l2"><a class="reference internal" href="references/core/io.html">io</a></li>
<li class="toctree-l2"><a class="reference internal" href="references/core/argparser.html">argparser</a></li>
<li class="toctree-l2"><a class="reference internal" href="references/core/commands.html">commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="references/core/files.html">files</a></li>
<li class="toctree-l2"><a class="reference internal" href="references/core/gitmanager.html">gitmanager</a></li>
<li class="toctree-l2"><a class="reference internal" href="references/core/http.html">http</a></li>
<li class="toctree-l2"><a class="reference internal" href="references/core/text.html">text</a></li>
</ul>
</li>
</ul>
</div>
<div class="toctree-wrapper compound" id="changelog">
<p class="caption"><span class="caption-text">Changelog</span><a class="headerlink" href="#changelog" title="Link a questo indice">¶</a></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog/version_1_0.html">v1.0.0</a></li>
</ul>
</div>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Link a questa intestazione">¶</a></h2>
<p><a class="reference external" href="https://github.com/azionaventures/aziona-cli/blob/main/LICENSE">GNU General Public License
v3.0</a></p>
</div>
</div>
<div class="section" id="indice">
<h1>Indice<a class="headerlink" href="#indice" title="Link a questa intestazione">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Indice</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Indice dei moduli</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Cerca</span></a></p></li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="references/cli/index.html" class="btn btn-neutral float-right" title="cli" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Azionaventures.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>